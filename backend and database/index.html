<!DOCTYPE html>
<html>
<head>
<title>Hello, Adventure</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inconsolata">
<link rel="stylesheet" href="./style.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
<script src="settings.js"></script>
</head>
<body>

<!-- Links (sit on top) -->
<div class="w3-top">
    <div id="bar-items" class="w3-row w3-black w3-container w3-center w3-padding-16 w3-large">
        <a href="#top" class="w3-button w3-inline w3-black w3-padding w3-margin-right">HOME</a>
        <button id="logout" class="guest-content admin-content student-content w3-button w3-inline w3-black w3-padding w3-margin-left">LOGOUT</button>
        <a href="#about" class="none-content w3-button w3-inline w3-black w3-padding w3-margin-left">ABOUT</a>
    </div>
</div>

<!-- Header with image -->
<header style="min-height: 50%" class="bgimg w3-display-container w3-grayscale-min" id="home" hidden>

  <div class="admin-content w3-display-middle w3-center d-flex align-center">
    <span class="w3-text-white welcome" style="font-size:4.5rem; padding-top: 50px">WELCOME BACK,<br>ADMIN</span>
  </div>

  <div class="student-content w3-display-middle w3-center d-flex align-center">
    <span class="w3-text-white welcome" style="font-size:4.5rem; padding-top: 50px">WELCOME BACK,<br>STUDENT</span>
  </div>

  <div class="guest-content w3-display-middle w3-center d-flex align-center">
    <span class="w3-text-white welcome" style="font-size:4.5rem; padding-top: 50px">WELCOME BACK<br>GUEST</span>
  </div>

  <div class="none-content w3-display-middle w3-center">
    <span class="w3-text-white" style="font-size:75px">HELLO, ADVENTURE</span>
  </div>
</header>

<!-- Add a background color and large text to the whole page -->
<div class="w3-sand w3-grayscale w3-large">

<div class="w3-container w3-center" id="content" hidden>

    <div class="admin-content d-flex justify-evenly">
      <a style="width: 15%; aspect-ratio: 1 / 1;" class="w3-center card w3-black w3-hover-blue w3-margin" href="classlist.html">YOUR<br>CLASS</a>
      <a style="width: 15%; aspect-ratio: 1 / 1;" class="w3-center card w3-black w3-hover-blue w3-margin" href="profile.html">YOUR<br>PROFILE</a>
    </div>

    <div id="reminder" class="student-content d-flex-col align-center" style="margin: 0; margin-bottom: 5px;">
      <p class="w3-text-black w3-tag w3-white w3-padding" style="font-size:40px; border-radius: 10px;">YOU HAVE INCOMPLETE ASSIGNMENTS</p>
    </div>
    
    <div class="student-content d-flex justify-evenly">
        <a style="width: 15%; aspect-ratio: 1 / 1;" class="w3-center card w3-black w3-hover-blue w3-margin" href="gamePage.html">RESUME STORY</a>
        <a style="width: 15%; aspect-ratio: 1 / 1;" class="w3-center card w3-black w3-hover-blue w3-margin" href="studentAssignments.html">YOUR<br>CLASS</a>
        <a style="width: 15%; aspect-ratio: 1 / 1;" class="w3-center card w3-black w3-hover-blue w3-margin" href="profile.html">YOUR<br>PROFILE</a>
    </div>

    <div class="guest-content d-flex justify-evenly">
        <a style="width: 15%; aspect-ratio: 1 / 1;" class="w3-center card w3-black w3-hover-blue w3-margin" href="gamePage.html">RESUME STORY</a>
        <a style="width: 15%; aspect-ratio: 1 / 1;" class="w3-center card w3-black w3-hover-blue w3-margin" href="profile.html">YOUR<br>PROFILE</a>
    </div>

    <div class="none-content w3-content d-flex justify-center w3-padding" style="max-width:60%;">
      <div class="d-flex-col justify-center align-center" style="width: 60%; padding: 0; margin: 0;">
        <h5 class="w3-center w3-padding-16 w3-xlarge"><span class="w3-tag w3-wide w3-padding">JOIN THE ADVENTURE</span></h5>
        <p id="status" class="w3-padding w3-red w3-center" hidden>USERNAME OR PASSWORD INCORRECT</p>
        <form id="login" class="separate-children" style="width: 100%;" onsubmit="return false">
            <label for="username">USERNAME</label><br>
            <input style="min-width:45%" type="text" id="username" name="username" required><br>
            <label for="password">PASSWORD</label><br>
            <input style="min-width:45%" type="password" id="password" name="password" required><br>
            <input style="min-width: 20%;" type="submit" value="SIGN IN">
            <a class="w3-white w3-border w3-hover-gray w3-hover-text-white w3-padding" href="./registration.html">Register</a>
        </form>
      </div>
    </div>
</div>

<!-- About Container -->
<div class="w3-container" id="about" hidden>
  <div class="w3-content" style="max-width:50%">
    <h5 class="w3-center w3-padding-64"><span class="w3-tag w3-wide">ABOUT HELLO ADVENTURE</span></h5>
    <p>While there is some formal education for computer science, it is very limited, and the basic concepts aren't even introduced until high school or college. In these fast-paced environments, students who are new to computer science may find it extremely difficult to keep up with the concepts. Insufficient learning resources makes it difficult to truly enjoy computer science and, worst case, discourages the student from continuing their education at all.</p>
    <p>Enter Hello, Adventure, an educational game used to introduce young students to data structures and algorithms concepts. Hello Adventure features worlds that focus on a specific data structures, and levels within each world that will have users learn and play with algorithms related to a given structure in a fun and retainable manner.</br></br> </p>
  </div>
</div>

<!-- End page content -->
</div>

<!-- Footer -->
<footer class="w3-center w3-light-grey w3-padding-16 w3-large">
  <p>Hello, Adventure</p>
  <p>2023</p>
</footer>
</body>
</html>

<script>
  $(document).ready(async function() {
    // Get the account type & update the page
    await fetch(LOCALHOST + SERVER_PORT + '/getAccountType')
    .then(response => response.json())
    .then(async function(data) {
      // Get respective content & hide all of it
      $admin = $(".admin-content")
      $student = $(".student-content")
      $guest = $(".guest-content")
      $none = $(".none-content")

      $admin.hide()
      $student.hide()
      $guest.hide()
      $none.hide()
      
      // Reveal the content corresponding to the user account type
      if(data['account-type'] === 'student') {
        $student.show()
        
        // Check if this student has incomplete assignments
        await fetch(LOCALHOST + SERVER_PORT + '/getIncompleteAssignments')
        .then(response => response.json())
        .then(data => {
          // Find assignment container
          $reminder = $("#reminder")

          // Load assignments
          assignments = data['assignments']

          // Some assignments are incomplete
          if(assignments.length != 0) {
            assignments.forEach(element => {
              // Add new reminder
              $reminder.append(
                  `<p class="w3-tag w3-padding assignment-reminder">${element}</p>`
              )
            }) 
          } else {
            // Hide reminder
            $reminder.hide()
          }
        })

      }
      else if(data['account-type'] === 'admin') {
        $admin.show()
      }
      else if(data['account-type'] === 'guest') {
        $guest.show()
      }
      else {
        $about = $("#about")
        $about.show()
        $none.show()
      }

      $(".welcome").html(`WELCOME BACK<br>${data['name']}`)

      // Reveal the page
      $("#home").show()
      $("#content").show()
    })


    // Check if an error occurred
    var url = window.location.href
    if(url.indexOf("?error=true") != -1)
        $("#status").show()

    $(".assignment-reminder").on('click', async function() {
      window.location = LOCALHOST + CLIENT_PORT + '/assignmentDetails.html?assignment=' + $(this).text()
    })
      
    $("#login").on('submit', async function() {
        // Get all the forms elements and their values in one step
        let $username = $(this).find('input[name="username"]')
        let $password = $(this).find('input[name="password"]')
        
        // Store inputs in an object
        var inputValues = {
            "username":$username.val(),
            "password":$password.val(),
        } 

        // Resetting input fields
        $username.val("")
        $password.val("")

        // POST request to attempt login
        await fetch(LOCALHOST + SERVER_PORT + '/verifyLogin', {
                method: "POST",
                headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
                },
                body: JSON.stringify(inputValues)
        })
        .then(response => {
            // Check if login was successful
            if(response.status === 409) {
                window.location = LOCALHOST + CLIENT_PORT + '/?error=true'
            } else {
                window.location = LOCALHOST + CLIENT_PORT
            }
        })
    })

    // Function for logging out of session
    $("#logout").on("click", async function() {
      // Sending request
      await fetch(LOCALHOST + SERVER_PORT + "/logout", {
        method: "POST"
      })
      .then(response => {
        // Redirecting to home
        window.location = LOCALHOST + CLIENT_PORT
      })
    })

  })
</script>